@page
@{
    ViewData["Title"] = "Dashboard - Upload Document";
}

<h2>Upload a Document</h2>

<!-- File upload section -->
<div style="display: flex; align-items: center; margin-bottom: 15px;">
    <!-- Input box for file -->
    <input type="file" id="fileInput" name="UploadedFile" required style="padding: 10px; margin-right: 15px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; width: 300px;" />
</div>

<!-- Upload Button -->
<div>
    <button type="button" id="uploadButton" style="padding: 10px 20px; background-color: #007bff; color: white; 
    border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">Upload</button>
</div>

<!-- Modal for Error Message -->
<div id="errorModal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
background: rgba(0,0,0,0.7); color: white; padding: 20px; border-radius: 5px; z-index: 9999; max-width: 400px; width: 100%; text-align: center;">
    <h4>Error</h4>
    <p id="errorMessage" style="font-size: 18px;"></p>
    <button onclick="closeModal()" style="background-color: #dc3545; color: white; padding: 8px 16px; border:
     none; border-radius: 4px; font-size: 16px; cursor: pointer;">Close</button>
</div>

<!-- Modal for Success Message -->
<div id="successModal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
background: rgba(0,128,0,0.7); color: white; padding: 20px; border-radius: 5px; z-index: 9999; max-width: 400px; width: 100%; text-align: center;">
    <h4>Success</h4>
    <p id="successMessage" style="font-size: 18px;"></p>
    <button onclick="closeSuccessModal()" style="background-color: #28a745; color: white; padding: 8px 16px; border: 
    none; border-radius: 4px; font-size: 16px; cursor: pointer;">Close</button>
</div>

<script>
    document.getElementById("fileInput").addEventListener("change", function (event) {
        let fileName = event.target.files[0] ? event.target.files[0].name : "No file chosen";
        // Here, we don't need to display the file name outside the input, so simply handle it as required
    });

    document.getElementById("uploadButton").addEventListener("click", function (event) {
        event.preventDefault(); // Prevent default form submission

        let formData = new FormData();
        let fileInput = document.getElementById("fileInput").files[0];

        // Check if no file is selected
        if (!fileInput) {
            showErrorModal("No file selected. Please choose a file to upload.");
            return;
        }

        // Validate file type (only .docx allowed)
        let fileExtension = fileInput.name.split('.').pop().toLowerCase();
        if (fileExtension !== "docx") {
            showErrorModal("Only .docx files are allowed. Please upload a valid file.");
            document.getElementById("fileInput").value = "";
            return;
        }

        formData.append("UploadedFile", fileInput); // Ensure this matches the parameter name in the controller

        fetch("/dashboard/upload", { // POST to controller endpoint
            method: "POST",
            body: formData
        })
        .then(response => response.json()) // Parse JSON response
        .then(data => {
            if (data.success) {
                showSuccessModal("File uploaded successfully!"); // Show success message
            } else {
                showErrorModal(`Error: ${data.message}`); // Show error message
            }
        })
        .catch(error => {
            showErrorModal(`Upload failed. ${error.message}`);
            console.error("Upload error:", error);
        });

        // Clear the file input after the form submission
        document.getElementById("fileInput").value = "";
    });

    // Function to display error modal with the provided message
    function showErrorModal(message) {
        document.getElementById("errorMessage").innerText = message;
        document.getElementById("errorModal").style.display = "block"; // Show error modal
        document.getElementById("successModal").style.display = "none"; // Hide success modal
    }

    // Function to display success modal with the provided message
    function showSuccessModal(message) {
        document.getElementById("successMessage").innerText = message;
        document.getElementById("successModal").style.display = "block"; // Show success modal
        document.getElementById("errorModal").style.display = "none"; // Hide error modal
    }

    // Function to close the error modal
    function closeModal() {
        document.getElementById("errorModal").style.display = "none"; // Hide the error modal when user clicks "Close"
    }

    // Function to close the success modal
    function closeSuccessModal() {
        document.getElementById("successModal").style.display = "none"; // Hide the success modal when user clicks "Close"
    }
</script>

<!-- Styles for the page -->
<style>
    /* File input section styles */
    input[type="file"] {
        padding: 10px;
        margin-right: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        width: 300px;
    }

    /* Upload button styles */
    #uploadButton {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    /* Modal styles */
    #errorModal, #successModal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        padding: 20px;
        border-radius: 5px;
        z-index: 9999;
        max-width: 400px;
        width: 100%;
        text-align: center;
    }

    /* Error modal background */
    #errorModal {
        background: rgba(0,0,0,0.7);
    }

    /* Success modal background */
    #successModal {
        background: rgba(0,128,0,0.7);
    }

    /* Modal button styles */
    button {
        background-color: #dc3545; /* Error button for error modal */
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
    }

    #successModal button {
        background-color: #28a745; /* Success button for success modal */
    }

    /* Status message styles */
    #statusMessage {
        margin-top: 20px;
        color: #333;
    }
</style>
